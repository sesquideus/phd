\documentclass[12pt, aspectratio=1610]{beamer}
\input{../../kvik.sty}
\input{../../kvik-beamer.sty}

\usepackage{tabularx}


\title{The AMOS database system}
\subtitle{Storing data, one meteor at a time}
\author{Mgr. Martin Baláž}
\institute{DAA DAPEM colloquium}
\date{2019--04--17}

\begin{document}
    \begin{frame}
        \titlepage
    \end{frame}
                
    \section{Overview}
        \subsection{Overview}
            \frejm{Contents}{
                \setbeamersize{description width = 30mm}
                \begin{description}
                    \item[objective]        What are we doing?
                    \item[motivation]       Why?
                    \item[implementation]   How?
                    \item[results]          What have we done?
                \end{description}
            }
            
            \frejm{Objective}{
                \begin{itemize}
                    \item to build a database system for storing real meteor data
                    
                    \item it should be
                    \setbeamersize{description width = 40mm}
                    \begin{description}
                        \item<1->[web-based]        accessible from anywhere
                        \item<2->[comprehensible]   we are able to identify interesting events easily
                        \item<3->[autonomous]       integrate the entire processing pipeline
                    \end{description}
                \end{itemize}
            }
            
            \frejm{Motivation}{
                Current state is \only<1>{a disaster}\only<2->{\sout{a disaster} slightly suboptimal}
                \pause
                \begin{itemize}
                    \item no unified data file format
                    \item data spread across multiple computers
                    \item analysis next to impossible
                    \begin{itemize}
                        \item and I badly missed it in my diploma thesis
                    \end{itemize}
                \end{itemize}
                \pause
                \emph{Let us tidy up and organize the data!}
            }
        
    \section{Data}
        \subsection{Data}
            \frejm{Acquisition}{
                Data are acquired by AMOS cameras
                \begin{itemize}
                    \item \emph{UFOCapture} by SonotaCo
                    \item \emph{AMOS} by Kvant
                    \begin{itemize}
                        \item will be ready in about two months...
                        \pause
                        \item ...for the last three years
                    \end{itemize}
                \end{itemize}
            }
            
            \frejm{Pre-processing}{
                First of all, raw data are filtered and annotated

                \begin{itemize}
                    \item meteor recognition and data extraction
                    \begin{itemize}
                        \item position in the sky
                        \item magnitude
                        \item angular speed
                        \item ...
                    \end{itemize}
                    \pause
                    \item saved in an \code{XML} file
                    \item raw video stored in uncompressed \code{AVI} file
                    \item overview in a \code{JPG} file
                \end{itemize}
                \pause
                \begin{itemize}
                    \item not much can be done about this
                \end{itemize}
            }
            
            \frejm{Retrieval}{
                \emph{Currently}:
                \begin{itemize}
                    \item UFOCapture launches a \code{bat} file
                    \item mail transfer via SMTP (e-mail)
                    \item processed by \code{charon}
                \end{itemize}

                \emph{Proposal}:
                \begin{itemize}
                    \item video capturing software forwards data to a daemon
                    \item sent over HTTP in a POST request
                    \pause
                    \item we need an \emph{API}
                    \begin{itemize}
                        \item station submits a new \code{Sighting}
                        \item website retrieves a list of \code{Meteor}s
                        \item daemon periodically computes \code{Meteor} data
                        \item other internal use (maps, analyses...)
                    \end{itemize}
                \end{itemize}
            }
            
            \frejm{Processing}{
                Data need to be \emph{validated} and \emph{processed}
                \begin{itemize}
                    \item remove invalid data (false detections, ...)
                    \item compute \code{Meteor}s from multiple \code{Sighting}s
                    \item 

                \end{itemize}
            }
            
            \frejm{Storage}{
                At this point data are ready to be stored
                \begin{itemize}
                    \item in a \emph{structured} and \emph{semantic} way
                    \item consistency is \emph{enforced} at all times
                    \item auxiliary data
                    \begin{itemize}
                        \item housekeeping
                        \item statistics
                    \end{itemize}
                \end{itemize}
            }

            \frejm{Data retention}{
                To prevent problems down the line, we should
                \pause
                \begin{itemize}
                    \item keep \emph{all} raw data available
                    \pause
                    \item never delete anything
                    \begin{itemize}
                        \item unless provably incorrect
                    \end{itemize}
                    \pause
                    \item enable raw data re-processing
                    \begin{itemize}
                        \item data import from an offline station                        
                        \item manual correction
                        \item new processing algorithms
                    \end{itemize}
                \end{itemize}
            }

            \frejm{Housekeeping}{
                \textit{Def:} Data of \emph{low scientific value} but \emph{high operational importance}\\[10mm]
                \pause
                \begin{columns}
                    \begin{column}{0.5\textwidth}
                        \begin{itemize}
                            \item environment
                                \begin{itemize}
                                    \item temperature
                                    \item humidity
                                    \item pressure
                                    \item ...
                                \end{itemize}
                        \end{itemize}
                    \end{column}
                    \pause
                    \begin{column}{0.5\textwidth}
                        \begin{itemize}
                            \item network
                                \begin{itemize}
                                    \item system uptime
                                    \item network connection
                                    \item UPS status
                                    \item ...
                                \end{itemize}
                        \end{itemize}
                    \end{column}
                \end{columns}
                \pause
                \begin{itemize}
                    \item displayed on dashboard
                \end{itemize}
            }
        
    \section{Database}
        \subsection{Database}
            \frejm{The database}{
                \emph{Problem}: We need a way to visualize and comprehend the data
                \pause
                \emph{Solution}: A database and a simple web interface
                \begin{itemize}
                    \item provides a basic framework for data operations
                    \item much more user-friendly than a bare directory listing
                    \item much easier to retrieve, sort and analyze the data
                \end{itemize}
            }

            \frejm{Design}{
                Underlying data are well-structured and suitable for an \emph{object-relational} database
            
                \begin{itemize}
                    \item we require
                    \begin{itemize}
                        \item<2-> full ACID compliance
                        \item<3-> free
                        \item<4-> able to scale well
                        \item<5-> decoupled from the rest of the system
                        \item<6-> I like it
                    \end{itemize}
                \end{itemize}

                \onslide<-2>{text files}    \onslide<-6>{PostgreSQL}    \onslide<-3>{SQLite}     \onslide<-5>{MySQL}      \onslide<-4>{NoSQL}
            }
            
            \frejm{ORDBMS}{
                \begin{itemize}
                    \item data are stored in \emph{relations} (tables)
                    \item each column stores the same \emph{property}
                    \item each row stores a single \emph{entity} (object)
                    \item each object has an identifier -- \emph{primary key}
                    \item fields may point to other tables -- \emph{foreign keys}
                    \item data are accessed and manipulated using a \emph{query language}
                \end{itemize}
            }

            \begin{frame}[fragile]
                \frametitle{ORDBMS}
                \small
                \begin{overlayarea}{\textwidth}{0.6 \textheight}
                    \ \\
                    \highlightbox<2>{orange}{\texttt{SELECT "id", "timestamp", "magnitude" \textbackslash}} \\
                    \highlightbox<3>{orange}{\texttt{FROM "meteors" \textbackslash}} \\
                    \highlightbox<4>{orange}{\texttt{WHERE "timestamp" BETWEEN "2019-04-16 15:00:00" AND "2019-04-17 09:00:00" \textbackslash}} \\
                    \highlightbox<5>{orange}{\texttt{ORDER BY "magnitude" \textbackslash}} \\
                    \highlightbox<6>{orange}{\texttt{ASC LIMIT 5;}}
                    \begin{onlyenv}<7>
                    \begin{verbatim}
356, "2019-04-17 03:45:10", -5.8
728, "2019-04-17 04:14:23", -3.2
456, "2019-04-16 23:56:04", -2.7
908, "2019-04-17 01:23:45", -2.5
854, "2019-04-16 21:58:35", -2.2
                    \end{verbatim}
                    \end{onlyenv}
                \end{overlayarea}
            \end{frame}
                    
            \frejm{Models}{
                The art and science of creating databases...
                \pause
                ...is to naturally translate the real world to models:
                \pause
                \begin{itemize}
                    \item \code{Meteor}
                    \item \code{Sighting}
                    \item \code{Station}
                    \item \code{Subnetwork}
                    \item \code{Country}
                    \item ...more as needed
                \end{itemize}
            }
            
            \frejm{Model \code{Sighting}}{
                Describes the \emph{sighting} of a single meteor by an AMOS camera
                \begin{itemize}    
                    \item identifier
                    \item observed projected position on the sky
                        \item three coordinates
                        \begin{itemize}
                            \item azimuth
                            \item altitude
                        \end{itemize}
                        \pause
                        \item at three moments
                        \begin{itemize}
                            \item \emph{beginning}
                            \item \emph{maximum brightness}
                            \item \emph{end}
                        \end{itemize}      
                    \item maximum apparent magnitude            
                \end{itemize}
            }
            
            \frejm{Model \code{Sighting} -- extras}{
                \begin{itemize}
                    \item miscellaneous computed information
                        \begin{itemize}
                            \item arc length
                            \item duration
                            \item Sun and Moon info
                            \begin{itemize}
                                \item position
                                \item elongation
                                \item magnitude
                                \item not stored in the database
                            \end{itemize}
                        \end{itemize}
                    \pause
                    \item visualisation
                        \begin{itemize}
                            \item real photograph from AMOS
                            \item corresponding simulation (?)
                        \end{itemize}                    
                \end{itemize}
            }
            
            \frejm{Model \code{Meteor}}{  
                Describes the actual \emph{event}, an atmospheric entry of a meteoroid particle
                \begin{itemize}
                    \item \emph{timestamp}
                    \item true geographic location
                    \begin{itemize}
                        \item again, four coordinates
                        \begin{itemize}
                            \item \emph{timestamp}
                            \item \emph{latitude}
                            \item \emph{longitude}
                            \item \emph{altitude}
                        \end{itemize}
                        \pause
                        \item at three moments
                        \begin{itemize}
                            \item \emph{beginning}
                            \item \emph{maximum brightness}
                            \item \emph{end}
                        \end{itemize}
                    \end{itemize}
                \end{itemize}
            }
            
            \frejm{Model \code{Meteor} -- auxiliary data}{
                \begin{itemize}                
                    \item true \emph{trail length}
                    \begin{itemize}
                        \item this is not well-defined
                    \end{itemize}
                    \item computed maximal \emph{absolute magnitude} (least-squares)
                    \item \emph{visualisation}
                    \begin{itemize}
                        \item \code{KML} file for \emph{Google Earth}
                        \item \emph{online map} (OpenLayers)
                    \end{itemize}
                \end{itemize}
            }
        
            \frejm{Database diagram}{
                \includegraphics[page = 2, width = 0.875 \textwidth]{diagram.pdf}
            }
    
    \section{Visualisation}
        \subsection{Visualisation}
            \frejm{Overview}{
                We have implemented a website in \emph{Python/Django}

                \begin{itemize}
                    \item webserver + CRUD operations
                    \item administration interface (courtesy of Django)
                    \item REST framework
                \end{itemize}
            }

            \frejm{Dashboard}{
                We need to detect problems and bring them to attention
                \begin{itemize}
                    \item add \code{status} property to \code{Station}
                    \item various problems can be detected and addressed
                    \begin{itemize}
                        \item lost connection
                        \item lost power
                        \item software problem
                        \item AMOS hardware failure
                        \item no data
                        \item ...
                    \end{itemize}
                    \pause
                    \item requires station-side changes to software
                \end{itemize}
            }

            \frejm{System in operation}{
                As of now, the core of the system is operational
                \begin{itemize}
                    \item \href{http://192.168.0.177:4805/}{Dashboard}
                    \item \href{http://192.168.0.177:4805/meteors/}{Meteor list}
                    \item \href{http://192.168.0.177:4805/sighting/2537}{Example of a sighting}
                    \item \href{http://192.168.0.177:4805/meteor/example/path}{Example of a meteor path}
                \end{itemize}                 
                \pause
                We need to implement
                \begin{itemize}
                    \item remote station monitoring
                    \item data import routines
                    \item data export (\code{CSV}, \code{JSON}, ...)
                \end{itemize}
            }

            \frejm{And then?}{
                (add what to do then)
            }
    
        \frejm{Thank you for your attention}{
            {\large \textit{Above all else, show the data.}}
            \scriptsize
            \begin{flushright}
                Edward R. Tufte\\
                The Visual Display of Quantitative Information, 1983
            \end{flushright}
        }      
                
        \frejm{References}{
            \begin{itemize}
                \item \textbf{Database.Guide}:
                    What is an ORDBMS? \texttt{https://database.guide/what-is-an-ordbms/}
                \item \textbf{}
            \end{itemize}
        }
            
\end{document}

\Epigraph[0.4]{
    All work and no play makes Jack a dull boy,\\
    All play and no work makes Jack a mere toy.
}{
    \textit{English proverb} \\
    \textit{enhanced by} \textsc{Maria Edgeworth} \\
    \textit{in} Harry and Lucy Concluded (1825)
}

Once we have ascertained what physical objects and phenomena we are going to be working with and what we want to achieve,
we need to understand \emph{how} this can be done and how these phenomena can be captured in a simplified \emph{model}.

\section{Models}
    

    \section{Properties} \label{mp}
        \section{Radiants} \label{mpr}
            \todo{solar longitude}
            \todo{motion of radiant}
            \todo{explain}

        \section{Additional properties} \label{mpa}
            Apart from the dynamical properties, which describe only the density of particles
            and thus a probability of a collision at a point in space and time,
            we may (and should!) observe and analyze additional properties of the stream.

            \subsection{Mass distribution} \label{mpam}
                The most important characteristic of a meteoroid population is the distribution of masses
                among constituent particles. A shower that is primarily composed of massive particles
                will produce a large number of spectacular fireballs while its ZHR may remain fairly low;
                while another shower may consist of a large number of tiny meteoroids with low cumulative mass,
                yet will result in large ZHR.

                In meteor science, it is customary to assume a specific distribution of masses within a population,
                described by a power law with particle mass as the independent variable:
                \eqn{eq:mas-map}{
                    \varrho(m) \propto m^{-s}
                }
                for some constant $s$ named the \emph{mass index}.

                To obtain a distribution, this expression needs to be normalised first,
                effectively yielding a well-known Pareto distribution \citep{arnold1983}.
                In mathematical texts it is usually defined as $\Distribution{\mathrm{Pareto}}{x}{\alpha, x_0}$,
                where $\alpha > 0$ is called \emph{shape} and $x_0 > 0$ is called the \emph{scale} of the distribution.

                To conform to terms commonly used with meteors we substitute these for mass index
                $s = \alpha - 1$, while $x_0 \equiv m_\mathrm{min}$ denotes the \emph{minimum mass}
                of particles considered. The probability density function is then
                \eqn{eq:mas-pareto}{
                    \varrho(m) = \mathrm{Pareto}\left(m;\ s-1, {m_\mathrm{min}}\right) \equiv
                    \begin{cases}
                        0 &
                            \text{for }m < m_{\mathrm{min}}\text{,} \\
                        \dfrac{\left(s-1\right) m_{\mathrm{min}}^{s-1}}{m^s} &
                            \text{for }m \geq m_{\mathrm{min}}\text{.}
                    \end{cases}
                }

                Naturally, the extent to which the model can approximate the physical reality is limited.
                Typical values of $s$ are between \numrange{1.5}{2.5}, with values slightly below 2 being the most common \cite{...}

                In a very simple approximation, the luminosity of a meteor depends on its mass and entry speed as
                \eqn{eq:mas-lum}{
                    F_0 \propto mv^5.
                }

                For any meteor shower the speed is almost constant. Hence we know that the luminosity of meteors
                within a certain stream is thus solely a function of particle mass, and that this dependence should
                be approximately linear.

                (mention photometric mass)

            \subsection{Petrological and chemical classification} \label{mpac}
                While we are not explicitly interested in chemical properties
                or dynamical evolution of meteor streams, these properties
                are correlated with the density and toughness of the material,
                which in turn affect the process of ablation
                and thus also the final luminosity of the meteor.
                All of this contributes to the unwanted selection bias.

                So, in addition to previously mentioned \textit{numerical} data, we might want to
                provide extraneous information about the meteoroids, such as their origin,
                mineralogical or chemical properties.
                For many meteoroids these data are not be available,
                though as they provide a wealth of information on origin
                it is definitely useful to include it when available.


                toughness of particles, which in turn affects the penetration depth
                and the absolute brightness of meteors.
                Differences in spectra are responsible for variability in detection efficiency with different cameras.


\section{Simulation in the Solar System} \label{ms}
    on the order of 100 radii.

    With ephemerides taken from the JPL Horizons system \citep{???}.
    The simulation computes the positions of the large bodies of the Solar System, most importantly the Sun,
    the eight planets and the Moon. Then the test particles

    Optinally, positions of massless bodies can be offloaded to a Graphics Processing Unit (GPU).
    Using a GPU is particularly well suited to massively parallel problems, such as simulation of non-interacting test particles.

    Any particle intersecting the cross-section of the Earth is marked as detected and will be examined further.
    Alternatively, in order to reduce the number of trials, we may employ a larger artificial detector.


    as long as the spatial density is only varying on scales much larger than the radius of the Earth,
    temporal variations in activity will be small.
    This assumption is not universally valid, as some younger meteor showers often produce dense, narrow filaments,
    which can be observed as short but intensive outbursts of extraordinary meteor activity.
    A~good example are the November alpha-Monocerotids, with a period of significantly
    heightened activity spanning only about thirty minutes in 2019 \citep{CBET4692}.

    By comparing the orbital speed and the diameter of the Earth we can see that the Earth moves
    to a completely different position with respect to the stream within several minutes.
    This means that variations in activity are not going to be significant when crossing an old stream,
    whose radius may be on the order of millions of kilometres, but will be of extreme importance with young, narrow filaments.

    The duration of visible activity also depends on the exact shape of the stream and its orientation with respect to the orbit of the Earth.
    The worst case are the streams with high inclinations, where meteors seem to arrive from a direction perpendicular
    to the direction of movement.



    It is necessary that at least one of the orbital nodes must lie very close to the orbit of the Earth.
    This can be expressed in terms of orbital elements as
    \eqn{eq:p-anode}{
        \frac{p}{1 + e \cos \omega} \approx \SI{1}{\au}
    }
    for the ascending node, or, for the descending node,
    \eqn{eq:p-dnode}{
        \frac{p}{1 - e \cos \omega} \approx \SI{1}{\au}.
    }

    \subsection{The N-body problem} \label{msN}
        At the core of investigation of meteoroid motion in interplanetary space
        there is little more than a fairly complex $N$-body problem:
        we are given the initial positions and velocities of a set of objects,
        mutually interacting by gravitational attraction.
        However, rather than finding their positions and velocities at all future times, we are mostly concerned
        with the question whether some of these particles will ever collide with the Earth.

        Finding a closed-form solution is either not possible at all \cite{...}, or is only expressible
        as a convergent series with way too many terms to be of any practical use \citep{beloriszky-1930}.

        Fortunately, an exact closed-form solution is not needed. First of all, the precision of our results
        is always practically limited by the precision with which the initial conditions are known,
        which is always finite.

        Furthermore, small particles are often also influenced by non-gravitational forces,
        which are themselves difficult to describe analytically.
        Numerical solutions thus remain the astronomer's best friends.

        With modern integrators and available computational power this is no longer a problem.
        Even a cheap modern computer equipped with suitable software is able to calculate trajectories
        with precision only limited by our knowledge of initial positions and velocities of the bodies.


    \subsection{Numerical integration of equations of motion} \label{msi}
        The problem of obtaining a numerical solution to the equations of motion is omnipresent
        in astronomy and as such has been solved many times with increasingly better precision.

        Since every two bodies attract each other, finding all forces acting on the bodies generally
        requires computation of $n\left(n - 1\right) = \BigO{n^2}$ pairs of forces \cite{???}.
        According to Newton's third law opposing forces are equal in magnitude and opposite in their direction,
        and thus one evaluation in every pair is enough. This brings the number of required evaluations to half the stated value,
        without changing the order.

        \subsubsection{Massively parallel integration} \label{msip}
            The main difference in simulating small particles, such as meteoroids,
            is that their masses are for all practical purposes completely negligible.
            All gravitational interaction between pairs of test particles may be completely ignored,
            which drastically reduces the number of evaluations.

            Suppose we only need to work with $k$ massive objects:
            in the Solar System we need to consider the Sun, eight planets, their major moons
            and -- at least immediately after the ejection -- also the parent body of the stream.
            This leaves us with $k \sim 10$, which translates to roughly 50--100 evaluations per integration step.
            This is perfectly tractable on a CPU.

            Once the positions of physical bodies are known, we may proceed to computing the forces acting
            on test bodies. Since forces are to be summed as vectors, we need $k$ evaluations
            for each of $n$ test particles, for a total of $nk$ evaluations.
            Generally, there is no further exploitable symmetry.
            However, problems of this sort are perfectly suited for parallel computation.

            The total number of evaluations is
            \eqn{eq:asip-total}{
                E(k, n) = k^2 + nk.
            }

            Since in our case $n \gg k$, this approximately equals $nk$.

            The preferred \textit{modus operandi} at this time seems to be to use off-the-shelf integrators
            running on a CPU for resolving the positions and velocities of planets, and feed those data
            to a massively-parallel GPU integrator, simulating a large number of mutually non-interacting particles.

        \subsubsection{Using explicit ephemerides} \label{asie}
            To further simplify matters, we may leave the determination of positions and velocities
            to other software completely and free resources for other problems.
            We may directly use positions and velocities provided by some external source,
            such as JPL Horizons \cite{???}, or simply use precomputed tabelated values.

            This leaves us with only $kn$ interactions that are completely mutually independent.
            We hope to achieve sufficient performance to allow simulating about $10^7$ test particles within
            a reasonable time frame.

\section{Simulation in the atmosphere} \label{sa}
    Once it has been determined which meteoroids will enter the Earth's atmosphere, we may proceed to simulating
    the physical processes manifested during their atmospheric entry and obtain the values of physical quantities
    that are observed by ground-based observers.

    The coordinate frame of choice here is the Earth-Centered, Earth-Fixed frame (origin in the centre of mass of the Earth,
    reference plane is the equator and the reference direction is the international prime meridian).
    This reference frame is right-handed

    First of all, the position and velocity of the particle are transformed to the ECEF coordinate frame.

    To simulate the atmospheric entry we used \textsc{Asmodeus},
    a multi-purpose virtual meteor simulator developed as a part of our master's thesis and extended for numerous
    other purposes related to meteor astronomy \citep{balaz-thesis,balaz+2020}.

    Once a particle is selected for atmospheric entry, its velocity is transformed to the ECEF reference frame
    and a numerical integration of the equations of motion is executed.

    \subsection{Numerical integration of the equations of motion} \label{sai}
        Unlike in interplanetary space, where forces are completely dominated by the gravitational force exerted by the Sun,
        a particle entering the Earth's atmosphere switches between several regimes in rapid succession.
        The precise order is subject to variations due to particle's size, entry speed and angle
        and material composition.

        In the simulation we consider only two real forces:
        \begin{itemize}
            \item the \emph{drag force} $\vec{F_d}$, always acting against the instantaneous velocity vector of the particle;
            \item the \emph{gravitational force} $\vec{F_g}$, pulling the meteoroid towards the centre of the Earth.
        \end{itemize}

        Precision of calculations may be improved if we also account for two fictitious forces,
        arising from the fact the simulation is performed in a rotating reference frame:
        \begin{itemize}
            \item the fictitious \emph{centrifugal force} $\vec{F_{\mathrm{C}}}$,
                pushing the particle away from the axis of rotation of the Earth;
            \item and the fictitious \emph{Coriolis force} $\vec{F_{\mathrm{c}}}$,
                which pushes the moving body in a direction perpendicular to its velocity vector.
        \end{itemize}

        Except for the drag force, all forces can be readily expressed in terms of instantaneous
        position and velocity of the meteoroid and several constants.
        Calculating the drag force precisely is computationally very expensive and cannot be done
        without knowing the shape of the particle. Therefore we have to choose an appropriate simplified model.

        In its cosmic stage and during most of the motion in the gravitational sphere of influence of the Earth,
        the forces acting on the particle are dominated by gravitational effects. As the meteoroid penetrates
        deeper into the atmosphere, the density of the surrounding gas increases roughly exponentially.
        At its peak, the atmospheric drag force exceeds all other effects by several orders of magnitude,
        decelerating the meteoroid very rapidly.
        As the duration of the entire event is on the order of seconds, other forces simply do not act for long enough
        to produce a significant deviation in trajectory. For statistical evaluation of artificial meteors
        it is sufficient to consider only the drag force.

        However, should the meteoroid survive the entry as a meteorite, their influence is important during the dark phase of flight.

        \subsubsection{Coriolis force} \label{saiC}
            The fictitious Coriolis force arises in a rotating reference frame.
            \eqn{eq:saiC-coriolis}{
                \vec{F_{\mathrm{C}}} = -2 m \vec{\Omega}_\Earth \times \vec{v}.
            }

            For a meteoroid, its magnitude is at most on the order of
            \eqn{eq:saiC-order}{
                2 \frac{2\pi}{\SI{86400}{\second}} \cdot \SI{70}{\kilo\metre\per\second} \sim \SI{10}{\metre\per\second\squared},
            }
            roughly the same as gravitational acceleration.

        \subsubsection{Centrifugal force} \label{saic}
            The centrifugal force pushes the particles away from the axis of rotation of the Earth.
            \eqn{eq:saic-centrifugal}{
                \vec{F_{\mathrm{c}}} = - m \vec{\Omega}_\Earth \times \left(\vec{\Omega}_\Earth \times \vec{r}\right),
            }
            where $\vec{\Omega}_\Earth$ is the angular speed of rotation of the Earth,
            $\frac{2\pi}{\SI{86164}{\second}} \approx \SI{7.292e-5}{\per\second}$.

            Since it only depends on the instantaneous position, it can be thought of as a minor correction to the
            gravitational force. A simple calculation shows that its magnitude is on the order
            of \SI{0.03}{\metre\per\second\squared}. Near the surface it can be safely neglected for most purposes.
            If the simulation is used to investigate the motion of a meteoroid further from the Earth or
            on longer time scales, it becomes important.
            In this case an inertial reference frame should be used instead, though.

        \subsubsection{Gravitational force} \label{saig}
            The real shape of the gravitational potential around the Earth is fairly difficult to describe accurately
            However, for particles that are generally moving on highly hyperbolic trajectories the
            simple approximation by a Newtonian point source with mass $M_\Earth$ is more than sufficient.
            The formula used in computation is then simply
            \eqn{eq:saig-gravity}{
                \vec{F_{\mathrm{G}}} = - \frac{GM_\Earth}{r^3} \vec{r}.
            }

        \subsubsection{Drag force} \label{said}
            The precise description of the drag force is crucial to understand the motion
            of the particles in the atmosphere. The drag force is dominant between approximately
            the point where meteoroids begin to emit visible light (about \SI{100}{\kilo\metre})
            until the very end of the visible trail. For all but the most massive meteoroids,
            which are able to survive the atmospheric entry, this can be approximated
            by the point where all of the matter has been ablated away; while for the bodies
            surviving as meteorites, during the terminal phase of the flight the drag and
            gravitational forces are nearly balanced out.

            At peak deceleration the magnitude of the drag force can reach values several orders of magnitude
            higher than the sum of all other forces and is thus completely dominant.
            A very simple model of atmospheric flight can perform relatively well even when all other forces are neglected.


        Runge Kutta, DP, split-frame

    \subsection{Determination of other properties} \label{sap}

        \subsubsection{Absolute and visual magnitudes} \label{sapm}
